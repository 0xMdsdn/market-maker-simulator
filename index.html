<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Making Simulator</title>
    <meta name="description"
        content="Volatility-adaptive, inventory-aware market making strategy simulator with live and simulation modes">

    <!-- Lightweight Charts -->
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">üìä Market Making Simulator</h1>
            <div class="mode-toggle">
                <button id="btn-simulation" class="mode-btn active">Simulation</button>
                <button id="btn-live" class="mode-btn">Live</button>
            </div>
        </header>

        <!-- Control Panel -->
        <section class="control-panel">
            <div class="control-group">
                <label>Asset</label>
                <select id="asset-selector">
                    <option value="BTC">BTC</option>
                    <option value="ETH">ETH</option>
                    <option value="SOL">SOL</option>
                    <option value="APT">APT</option>
                </select>
            </div>

            <div class="control-group">
                <label>Balance ($)</label>
                <input type="number" id="initial-balance" value="1000" min="100" step="100">
            </div>

            <div class="control-group">
                <label>k_vol</label>
                <input type="number" id="param-kvol" value="0.2" min="0.1" max="1" step="0.05">
            </div>

            <div class="control-group">
                <label>k_pos</label>
                <input type="number" id="param-kpos" value="0.3" min="0.1" max="1" step="0.05">
            </div>

            <div class="control-group">
                <label>Tick Size</label>
                <input type="number" id="param-ticksize" value="1" min="0.001" step="0.001">
            </div>

            <div class="control-group">
                <label>Max Position</label>
                <input type="number" id="param-maxpos" value="0.5" min="0.01" step="0.1">
            </div>

            <div class="control-group simulation-only">
                <label>Volatility</label>
                <select id="volatility-regime">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
            </div>

            <div class="control-group simulation-only">
                <label>Drift</label>
                <input type="number" id="param-drift" value="0" step="0.0001">
            </div>

            <div class="control-group simulation-only">
                <label>ATR Length</label>
                <input type="number" id="param-atr-length" value="20" min="5" max="50" step="1">
            </div>

            <div class="control-group simulation-only">
                <label>RNG Seed</label>
                <input type="number" id="param-seed" value="12345" min="1" step="1">
            </div>

            <div class="control-buttons">
                <button id="btn-start" class="btn btn-start">‚ñ∂ Start</button>
                <button id="btn-stop" class="btn btn-stop" disabled>‚èπ Stop</button>
                <button id="btn-reset" class="btn btn-reset">‚Ü∫ Reset</button>
            </div>

            <div class="export-buttons">
                <button id="btn-csv" class="btn btn-export">üì• CSV</button>
                <button id="btn-json" class="btn btn-export">üì• JSON</button>
            </div>
        </section>

        <!-- Metrics Dashboard -->
        <section class="dashboard">
            <!-- Account Metrics -->
            <div class="metrics-card account-metrics">
                <h3>Account</h3>
                <div class="metric">
                    <span class="metric-label">Balance</span>
                    <span id="metric-balance" class="metric-value">$1,000.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Equity</span>
                    <span id="metric-equity" class="metric-value">$1,000.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Unrealized PnL</span>
                    <span id="metric-unrealized-pnl" class="metric-value neutral">$0.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Realized PnL</span>
                    <span id="metric-realized-pnl" class="metric-value neutral">$0.00</span>
                </div>
            </div>

            <!-- Market Metrics -->
            <div class="metrics-card market-metrics">
                <h3>Market</h3>
                <div class="metric">
                    <span class="metric-label">Mid Price</span>
                    <span id="metric-mid" class="metric-value">$0.00</span>
                </div>
                <div class="quote-display">
                    <div class="bid-display">
                        <span class="quote-label">BID</span>
                        <span id="metric-bid" class="quote-value bid">$0.00</span>
                        <span id="metric-bid-size" class="quote-size">0.000000</span>
                    </div>
                    <div class="spread-display">
                        <span class="spread-label">Spread</span>
                        <span id="metric-spread" class="spread-value">$0.00</span>
                    </div>
                    <div class="ask-display">
                        <span class="quote-label">ASK</span>
                        <span id="metric-ask" class="quote-value ask">$0.00</span>
                        <span id="metric-ask-size" class="quote-size">0.000000</span>
                    </div>
                </div>
                <div class="metric">
                    <span class="metric-label">ATR Volatility</span>
                    <span id="metric-atr" class="metric-value">0.0000</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Base Spread</span>
                    <span id="metric-base-spread" class="metric-value">0.0000</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Skew</span>
                    <span id="metric-skew" class="metric-value">0.0000</span>
                </div>
            </div>

            <!-- Positions -->
            <div class="metrics-card positions-metrics">
                <h3>Positions</h3>
                <div class="position long-position">
                    <div class="position-header">
                        <span class="position-label">LONG</span>
                        <span id="long-margin" class="position-margin">$0.00</span>
                    </div>
                    <div class="position-details">
                        <div class="position-field">
                            <span>Size</span>
                            <span id="long-size">0.000000</span>
                        </div>
                        <div class="position-field">
                            <span>Avg Price</span>
                            <span id="long-avg-price">$0.00</span>
                        </div>
                    </div>
                </div>
                <div class="position short-position">
                    <div class="position-header">
                        <span class="position-label">SHORT</span>
                        <span id="short-margin" class="position-margin">$0.00</span>
                    </div>
                    <div class="position-details">
                        <div class="position-field">
                            <span>Size</span>
                            <span id="short-size">0.000000</span>
                        </div>
                        <div class="position-field">
                            <span>Avg Price</span>
                            <span id="short-avg-price">$0.00</span>
                        </div>
                    </div>
                </div>
                <div class="imbalance-indicator">
                    <span class="metric-label">Imbalance</span>
                    <span id="metric-imbalance" class="metric-value">0.00%</span>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="chart-container">
                <h3>Price Chart</h3>
                <div id="price-chart" class="chart"></div>
            </div>
            <div class="chart-container">
                <h3>Equity Curve</h3>
                <div id="equity-chart" class="chart"></div>
            </div>
            <div class="chart-container">
                <h3>PnL</h3>
                <div id="pnl-chart" class="chart"></div>
            </div>
        </section>

        <!-- Data Tables -->
        <section class="tables-section">
            <div class="table-container">
                <h3>Trades <span id="trade-count" class="count-badge">0</span></h3>
                <div class="table-scroll">
                    <table id="trades-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Side</th>
                                <th>Price</th>
                                <th>Size</th>
                                <th>Margin</th>
                            </tr>
                        </thead>
                        <tbody id="trades-tbody">
                            <tr class="empty-row">
                                <td colspan="5">No trades yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="table-container">
                <h3>Collapses <span id="collapse-count" class="count-badge">0</span></h3>
                <div class="table-scroll">
                    <table id="collapses-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Size</th>
                                <th>PnL</th>
                            </tr>
                        </thead>
                        <tbody id="collapses-tbody">
                            <tr class="empty-row">
                                <td colspan="3">No collapses yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Status Bar -->
        <footer class="status-bar">
            <span id="status-mode" class="status-item">Mode: Simulation</span>
            <span id="status-asset" class="status-item">Asset: BTC</span>
            <span id="status-running" class="status-item">Status: Stopped</span>
            <span id="status-tick" class="status-item">Tick: 0</span>
        </footer>
    </div>

    <!-- App Script -->
    <script src="app.js"></script>
</body>

</html>